<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>Browser test</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="icon" href="./icon.svg" type="image/svg+xml" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <link rel="apple-touch-icon" href="./icon.png" sizes="192x192" />
    <link rel="manifest" href="./manifest.json" />
    <style>
      html {
        margin: 0;
        font-size: 20px;
      }
      body {
        margin: 0;
      }
      header {
        margin: 0;
        display: grid;
        grid-template-areas: 't g' 't v';
        grid-template-columns: auto auto;
        box-sizing: border-box;
        padding: 0 0.5rem;
      }
      h1 {
        margin: 0;
        font-size: 2rem;
        grid-area: t;
      }
      header > :not(h1) {
        text-align: right;
      }
      button {
        font-size: 1rem;
        cursor: pointer;
      }
      input {
        font-size: 1rem;
        width: 2rem;
      }
      label:has(input[type='checkbox']) {
        width: 1rem;
        height: 1rem;
        display: grid;
      }
      label > input[type='checkbox'] {
        margin: 0;
        padding: 0;
      }
      input:read-only {
        outline: none;
      }
      #code {
        width: 4rem;
      }
      #version::before {
        content: 'Ver: ' attr(data-version);
      }
    </style>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('register').addEventListener('click', () => {
          navigator.serviceWorker.register('./sw.js').then(() => {});
        });
        document.getElementById('unregister').addEventListener('click', () => {
          navigator.serviceWorker.getRegistration().then((registration) => {
            registration.unregister().then(() => {});
          });
        });
        document.getElementById('fullscreen').addEventListener('click', () => {
          document.documentElement.requestFullscreen({
            navigationUI: 'hide',
            // screen
          }).then(() => {});
        });
        document.getElementById('window').addEventListener('click', () => {
          document.exitFullscreen().then(() => {});
        });
        ((width, height) => {
          width.textContent = window.innerWidth;
          height.textContent = window.innerHeight;
          window.addEventListener('resize', () => {
            width.textContent = window.innerWidth;
            height.textContent = window.innerHeight;
          });
        })(document.getElementById('width'), document.getElementById('height'));
        ((key, code, ctrl, shift, alt, meta, locale, location, composing) => {
          document.body.addEventListener('keydown', (event) => {
            key.value = event.key;
            code.value = event.code;
            ctrl.checked = event.ctrlKey;
            shift.checked = event.shiftKey;
            alt.checked = event.altKey;
            meta.checked = event.metaKey;
            locale.value = event.locale || '';
            location.value = event.location;
            composing.checked = event.isComposing;
          });
          document.body.addEventListener('keyup', () => {
            key.value = '';
            code.value = '';
            ctrl.checked = false;
            shift.checked = false;
            alt.checked = false;
            meta.checked = false;
            locale.value = '';
            location.value = '';
            composing.checked = false;
          });
        })(...[
          'key',
          'code',
          'ctrl',
          'shift',
          'alt',
          'meta',
          'locale',
          'location',
          'composing',
        ].map((id) => {
          return document.getElementById(id);
        }));
      });
    </script>
  </head>
  <body>
    <header>
      <h1>Browser test</h1>
      <a href="https://github.com/azulamb/browser_test">GitHub</a>
      <small id="version" data-version="0.0.3"></small>
    </header>
    <div>
      <button id="register">Register</button>
      <button id="unregister">Unregister</button>
      <button id="fullscreen">Fullscreen</button>
      <button id="window">Window</button>
    </div>
    <div>
      <table>
        <tbody>
          <tr>
            <td>Width</td>
            <td id="width"></td>
          </tr>
          <tr>
            <td>Height</td>
            <td id="height"></td>
          </tr>
        </tbody>
      </table>
    </div>
    <div>
      <table>
        <tbody>
          <tr>
            <td>Key</td>
            <td>Code</td>
            <td>Ctrl</td>
            <td>Shift</td>
            <td>Alt</td>
            <td>Meta</td>
            <td>Locale</td>
            <td>Location</td>
            <td>Composing</td>
          </tr>
          <tr>
            <td><input type="text" id="key" readonly /></td>
            <td><input type="text" id="code" readonly /></td>
            <td><label><input type="checkbox" id="ctrl" readonly /></label></td>
            <td>
              <label><input type="checkbox" id="shift" readonly /></label>
            </td>
            <td><label><input type="checkbox" id="alt" readonly /></label></td>
            <td><label><input type="checkbox" id="meta" readonly /></label></td>
            <td><input type="text" id="locale" readonly /></td>
            <td><input type="number" id="location" readonly /></td>
            <td>
              <label><input type="checkbox" id="composing" readonly /></label>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </body>
</html>
